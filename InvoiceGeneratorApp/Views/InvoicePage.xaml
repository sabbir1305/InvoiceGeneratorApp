<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:InvoiceGeneratorApp.ViewModels"
             x:Class="InvoiceGeneratorApp.Views.InvoicePage"
             x:DataType="viewmodels:InvoiceViewModel"
             Title="Invoice Generator">

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="20">

            <!-- Header with Invoice Number -->
            <VerticalStackLayout HorizontalOptions="Center" Spacing="5">
                <Label Text="Invoice Generator" FontSize="28" FontAttributes="Bold" />
                <Label Text="{Binding CurrentInvoice.InvoiceNumber, StringFormat='Invoice No: {0}'}"
                       FontSize="18" TextColor="Gray" />
            </VerticalStackLayout>

            <!-- Customer Info -->
            <Frame BorderColor="LightGray" Padding="15" CornerRadius="10" HasShadow="True">
                <VerticalStackLayout Spacing="12">
                    <Label Text="Customer Information" FontAttributes="Bold" FontSize="20" />
                    <Entry Placeholder="Customer Name" Text="{Binding CurrentInvoice.CustomerName}" />
                    <Entry Placeholder="Address" Text="{Binding CurrentInvoice.CustomerAddress}" />
                    <Entry Placeholder="Email" Text="{Binding CurrentInvoice.CustomerEmail}" Keyboard="Email" />
                    <Entry Placeholder="Phone" Text="{Binding CurrentInvoice.CustomerPhone}" Keyboard="Telephone" />
                    <HorizontalStackLayout Spacing="10" VerticalOptions="Center">
                        <Label Text="Date:" VerticalOptions="Center" />
                        <DatePicker Date="{Binding CurrentInvoice.Date}" />
                    </HorizontalStackLayout>
                </VerticalStackLayout>
            </Frame>

            <!-- Add Item Section -->
            <Frame BorderColor="LightGray" Padding="15" CornerRadius="10" HasShadow="True">
                <VerticalStackLayout Spacing="12">
                    <Label Text="Add Item" FontAttributes="Bold" FontSize="20" />
                    <Entry Placeholder="Description" Text="{Binding ItemDescription}" />
                    <Entry Placeholder="Quantity" Keyboard="Numeric" Text="{Binding ItemQuantity}" />
                    <Entry Placeholder="Price" Keyboard="Numeric" Text="{Binding ItemPrice}" />
                    <Button Text="Add Item" Command="{Binding AddItemCommand}" />
                </VerticalStackLayout>
            </Frame>

            <!-- Items List -->
            <Frame BorderColor="LightGray" Padding="15" CornerRadius="10" HasShadow="True">
                <VerticalStackLayout>
                    <Label Text="Items" FontAttributes="Bold" FontSize="20" />
                    <CollectionView ItemsSource="{Binding Items}" HeightRequest="200">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Grid ColumnDefinitions="2*,Auto,Auto,Auto" Padding="5" RowSpacing="5">
                                    <Label Grid.Column="0" Text="{Binding Description}" LineBreakMode="TailTruncation" />
                                    <Label Grid.Column="1" Text="{Binding Quantity}" HorizontalOptions="End" />
                                    <Label Grid.Column="2" Text="{Binding Price, StringFormat='{}{0:C}'}" HorizontalOptions="End" />
                                    <Button Grid.Column="3" Text="X" BackgroundColor="Red" TextColor="White"
                                            Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:InvoiceViewModel}}, Path=RemoveItemCommand}"
                                            CommandParameter="{Binding .}" />
                                </Grid>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>
            </Frame>

            <!-- Totals -->
            <Frame BorderColor="LightGray" Padding="15" CornerRadius="10" HasShadow="True">
                <VerticalStackLayout Spacing="5">
                    <Label Text="Totals" FontAttributes="Bold" FontSize="20" />
                    <Label Text="{Binding CurrentInvoice.SubTotal, StringFormat='Subtotal: {0:C}'}" />
                    <Label Text="{Binding CurrentInvoice.Tax, StringFormat='Tax (10%): {0:C}'}" />
                    <Label Text="{Binding CurrentInvoice.Total, StringFormat='Total: {0:C}'}"
                           FontAttributes="Bold" FontSize="18" />
                </VerticalStackLayout>
            </Frame>

            <!-- Action Buttons -->
            <VerticalStackLayout Spacing="10">
                <HorizontalStackLayout Spacing="15">
                    <Button Text="New Invoice" Command="{Binding GenerateNewInvoiceCommand}" />
                    <Button Text="Save" IsEnabled="False" />
                    <!-- Enable after DB integration -->
                </HorizontalStackLayout>

                <HorizontalStackLayout Spacing="15">
                    <Button Text="Export to PDF" IsEnabled="False" />
                    <!-- Enable after PDF step -->
                    <Button Text="Print" IsEnabled="False" />
                    <!-- Enable after Print step -->
                </HorizontalStackLayout>
            </VerticalStackLayout>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
